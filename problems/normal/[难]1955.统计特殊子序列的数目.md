## [1955. 统计特殊子序列的数目](https://leetcode-cn.com/problems/count-number-of-special-subsequences/)

[讨论](https://leetcode-cn.com/problems/count-number-of-special-subsequences/comments/) | [题解](https://leetcode-cn.com/problems/count-number-of-special-subsequences/solution/)

Tags: 动态规划

> 特殊序列 是由 正整数 个 0 ，紧接着 正整数 个 1 ，最后 正整数 个 2 组成的序列。
>
> - 比方说，[0,1,2] 和 [0,0,1,1,1,2] 是特殊序列。
> - 相反，[2,1,0] ，[1] 和 [0,1,2,0] 就不是特殊序列。
> 给你一个数组 nums （仅 包含整数 0，1 和 2），请你返回 不同特殊子序列的数目 。由于答案可能很大，请你将它对 109 + 7 取余 后返回。
>
> 一个数组的 子序列 是从原数组中删除零个或者若干个元素后，剩下元素不改变顺序得到的序列。如果两个子序列的 下标集合 不同，那么这两个子序列是 不同的 。

```js
示例 1：

输入：nums = [0,1,2,2]
输出：3
解释：特殊子序列为 [0,1,2,2]，[0,1,2,2] 和 [0,1,2,2] 。
示例 2：

输入：nums = [2,2,0,0]
输出：0
解释：数组 [2,2,0,0] 中没有特殊子序列。
示例 3：

输入：nums = [0,1,2,0,1,2]
输出：7
解释：特殊子序列包括：
- [0,1,2,0,1,2]
- [0,1,2,0,1,2]
- [0,1,2,0,1,2]
- [0,1,2,0,1,2]
- [0,1,2,0,1,2]
- [0,1,2,0,1,2]
- [0,1,2,0,1,2]
```

限制:
- 1 <= nums.length <= 10^5
- 0 <= nums[i] <= 2

### 推导
依次遍历数组定义：
- f[i][0] 表示前 i 项得到的全 0 子序列个数
- f[i][1] 表示前 i 项得到的先 0 后 1 的子序列个数
- f[i][2] 表示前 i 项得到的特殊子序列个数

对于 f[i][0]，当遇到 0 时，有选或不选两种方案，不选 0 时有 f[i][0] = f[i - 1][0]；选 0 时，可以单独组成一个子序列，也可以与前面的 0 组合，因此有 f[i][0] = f[i - 1][0]+1，两者相加得 `f[i][0] = 2 * f[i - 1][0] + 1`；

对于 f[i][1]，当遇到 1 时，有选或不选两种方案，不选 1 时有 f[i][1] = f[i - 1][1]；选 1 时，可以单独与前面的 0 组成一个子序列，也可以与前面的 1 组合，因此有 f[i][1] = f[i - 1][1] + f[i - 1][0]，两者相加得 `f[i][1] = 2 * f[i - 1][1] + f[i - 1][0]`；

f[i][2] 和 f[i][1] 类似，有 `f[i][2] = 2 * f[i - 1][2] + f[i - 1][1]`；

最后答案为 f[i][2]。

### 题解
```js
/**
 * @param {number[]} nums
 * @return {number}
 */
 const mod = Math.pow(10, 9) + 7;
var countSpecialSubsequences = function(nums) {
    let A = 0, B = 0, C = 0;

    for (let i = 0, j = nums.length; i < j; i++) {
        const item = nums[i];
        if (item === 0) {
            A = (A * 2 + 1) % mod;
        } else if (item === 1) {
            B = (B * 2 + A) % mod;
        } else if (item === 2) {
            C = (C * 2 + B) % mod;
        }
    }

    return C;
};
```

### 举一反三

1. \[极端场景\]: 因为序列长度最大为 100000，如果全是0的话，那么A的最大值已经超出可显示范围，所以在每次计算时，需要进行取余操作；
```js
var A = 1;
for (let i = 1; i <= 100000; i++) {
 A = 2 * A + 1;
}
// Infinity
console.log(111, A);
```
